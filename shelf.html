<!DOCTYPE html>
<html>
<head>
<style>
    html, body {
        margin: 0;
        padding: 0;
        background: black;
        height: 100%;
        width: 100%;
        overflow: hidden;
    }

    #container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
        width: 100%;
        background: black;
        position: relative;
    }

    .layer {
        position: absolute;
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        user-select: none;
        -webkit-user-drag: none;
    }

    .overlay {
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease-in-out;
        z-index: 2;
    }
    

    #bookOverlay {
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease-in-out;
        z-index: 3;
    }

    #bookPages {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease-in-out;
        z-index: 4;
    }


    .page {
        position: absolute;
        width: 100%;
        height: 100%;
        display: none;
    }

    #leftZone, #rightZone {
        position: absolute;
        top: 0;
        width: 50%;
        height: 100%;
        z-index: 5;
        pointer-events: none;
    }

    #leftZone { left: 0; }
    #rightZone { right: 0; }

    #pageCounter {
        position: absolute;
        left: 89.7%;
        top: 72.8%;
        transform: translate(-50%, -50%);
        color: black;
        font-family: sans-serif;
        font-size: 18px;
        z-index: 10;
        pointer-events: none;
    }
</style>
</head>
<body>

<div id="container">
    <img id="scene" class="layer" src="bookshelf.png">
    <img id="mask" class="layer" src="bookshelfclickmap.png" style="display:none;">
    <img id="highlightBookOne" class="layer overlay" src="Hibook1.png">
    <img id="highlightBack" class="layer overlay" src="HiBack.png">
    <img id="bookOverlay" class="layer" src="book1.png">

    <div id="bookPages">
        <div class="page">
            <img src="CorkboardArchive1.png" style="position:absolute; top:0; left:0; max-width:50%; max-height:50%; object-fit:contain;">
        </div>
        <div class="page">
            <img src="page2.png" style="position:absolute; top:0; left:0; max-width:50%; max-height:50%; object-fit:contain;">
        </div>
        <div class="page">
            <img src="page3.png" style="position:absolute; top:0; left:0; max-width:50%; max-height:50%; object-fit:contain;">
        </div>
    </div>

    <!-- Page flip zones -->
    <div id="leftZone"></div>
    <div id="rightZone"></div>
    <div id="pageCounter">Page 1</div>

</div>

<script>
/* ELEMENTS */
const scene = document.getElementById("scene");
const mask = document.getElementById("mask");

const highlightBookOne = document.getElementById("highlightBookOne");
const highlightBack = document.getElementById("highlightBack");

const bookOverlay = document.getElementById("bookOverlay");

const bookPages = document.getElementById("bookPages");
const pages = Array.from(document.querySelectorAll(".page"));
const leftZone = document.getElementById("leftZone");
const rightZone = document.getElementById("rightZone");

const pageCounter = document.getElementById("pageCounter");

let currentPage = 0;

function updatePageCounter() {
    pageCounter.textContent = `Page ${currentPage + 1}`;
}

/* MASK CANVAS */
const canvas = document.createElement("canvas");
const ctx = canvas.getContext("2d");

mask.onload = () => {
    canvas.width = mask.naturalWidth;
    canvas.height = mask.naturalHeight;
    ctx.drawImage(mask, 0, 0);
};

function getPixelColor(e) {
    const rect = scene.getBoundingClientRect();
    const x = Math.floor((e.clientX - rect.left) * (mask.naturalWidth / rect.width));
    const y = Math.floor((e.clientY - rect.top) * (mask.naturalHeight / rect.height));
    const pixel = ctx.getImageData(x, y, 1, 1).data;
    return `${pixel[0]},${pixel[1]},${pixel[2]}`;
}

/* HOVER HIGHLIGHTS */
scene.addEventListener("mousemove", (e) => {
    if (bookOverlay.style.opacity === "1") return;

    const color = getPixelColor(e);

    highlightBookOne.style.opacity = 0;
    highlightBack.style.opacity = 0;

    if (color === "0,0,255") highlightBookOne.style.opacity = 1;  // book
    if (color === "255,255,0") highlightBack.style.opacity = 1;   // back
});

/* CLICK */
scene.addEventListener("click", (e) => {
    const color = getPixelColor(e);

    if (color === "0,0,255") {
        openBook();
    }

    if (color === "255,255,0") {
        window.location.href = "index.html";
    }
});

/* BOOK OPEN/CLOSE */
function openBook() {
    bookOverlay.style.opacity = 1;
    bookOverlay.style.pointerEvents = "auto";

    setTimeout(() => {
        openPages();
    }, 300);
}

bookOverlay.addEventListener("click", () => {
    closeBook();
});

function closeBook() {
    bookOverlay.style.opacity = 0;
    bookOverlay.style.pointerEvents = "none";
    closePages();
}

/* pg function reader */
function openPages() {
    currentPage = 0;
    pages.forEach(p => p.style.display = "none");
    pages[currentPage].style.display = "block";

    updatePageCounter();

    bookPages.style.opacity = 1;
    bookPages.style.pointerEvents = "auto";

    leftZone.style.pointerEvents = "auto";
    rightZone.style.pointerEvents = "auto";
}

function closePages() {
    bookPages.style.opacity = 0;
    bookPages.style.pointerEvents = "none";

    leftZone.style.pointerEvents = "none";
    rightZone.style.pointerEvents = "none";
}

/* PAGE FLIPPING */
function nextPage() {
    if (currentPage < pages.length - 1) {
        playFlipSound();
        pages[currentPage].style.display = "none";
        currentPage++;
        pages[currentPage].style.display = "block";
        updatePageCounter();
    }
}

function prevPage() {
    if (currentPage > 0) {
        playFlipSound();
        pages[currentPage].style.display = "none";
        currentPage--;
        pages[currentPage].style.display = "block";
        updatePageCounter();
    }
}

function playFlipSound() {
    const sfx = new Audio("pageflip.wav");
    sfx.play();
}

rightZone.addEventListener("click", nextPage);
leftZone.addEventListener("click", prevPage);

bookPages.addEventListener("click", (e) => {
    if (e.target === leftZone || e.target === rightZone) return;
    closeBook();
});
</script>

</body>
</html>