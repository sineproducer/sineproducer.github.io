<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shelf</title>

<style>
body {
  margin: 0;
  padding: 0;
  background: #000;
  display: flex;
  align-items: center;   /* vertical centering */
  justify-content: center; /* horizontal centering */
  height: 100vh; /* ensures full viewport height for vertical centering */
}

#scene-wrapper {
  position: relative;
  width: 100vw;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #000; /* fills the unused space */
}

#scene {
  width: 100%;
  height: 100%;
  background-image: url('bookshelf.png');
  background-size: contain;     /* ✅ keeps entire shelf visible */
  background-position: center;  /* ✅ centers it */
  background-repeat: no-repeat; /* ✅ no tiling */
}


#mask {
  display: none;
}

.highlight {
  position: absolute;
  pointer-events: none;
  opacity: 0;
}

#book {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  transition: opacity 0.3s ease;
}

#bookImage {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

#pages {
  position: absolute;
  top: 0;
  left: 0;
}

.page {
  position: absolute;
  top: 0;
  left: 0;
  display: none;
}

.item {
  position: absolute;
}

#pageCounter {
  position: absolute;
  bottom: 2%;
  right: 3%;
  color: white;
  font-size: 20px;
}
</style>
</head>

<body>

<div id="scene-wrapper">
    <div id="scene"></div>
    <img id="mask" src="bookshelf_mask.png">
    <img id="hiBook" class="highlight" src="highlight_blue.png">
    <img id="hiBack" class="highlight" src="highlight_yellow.png">

    <!-- book, pages, etc. -->
    <div id="book">
        <img id="bookImage" src="book1.png">

        <div id="pages">

            <div class="page">
                <img class="item" src="CorkboardArchive1.png" data-x="19" data-y="15" data-w="20">
                <img class="item" src="CorkboardArchive1.png" data-x="19" data-y="65" data-w="20">
                <img class="item" src="CorkboardArchive1.png" data-x="81" data-y="15" data-w="20">
                <img class="item" src="CorkboardArchive1.png" data-x="81" data-y="65" data-w="20">
            </div>

            <div class="page">
                <img class="item" src="page2_img1.png" data-x="19" data-y="15" data-w="20">
                <img class="item" src="page2_img2.png" data-x="19" data-y="65" data-w="20">
                <img class="item" src="page2_img3.png" data-x="81" data-y="15" data-w="20">
                <img class="item" src="page2_img4.png" data-x="81" data-y="65" data-w="20">
            </div>

        </div>

        <div id="pageCounter">Page 1</div>
    </div>

</div>

<script>
/* ---------------------------------------------------------
   DOM references
--------------------------------------------------------- */
const scene = document.getElementById("scene");
const mask = document.getElementById("mask");
const hiBook = document.getElementById("hiBook");
const hiBack = document.getElementById("hiBack");

const book = document.getElementById("book");
const bookImage = document.getElementById("bookImage");
const pages = Array.from(document.querySelectorAll(".page"));
const pageCounter = document.getElementById("pageCounter");

let currentPage = 0;
let bookOpen = false;

/* ---------------------------------------------------------
   Mask canvas
--------------------------------------------------------- */
const canvas = document.createElement("canvas");
const ctx = canvas.getContext("2d");

function drawMask() {
    if (!mask.naturalWidth) return;
    canvas.width = mask.naturalWidth;
    canvas.height = mask.naturalHeight;
    ctx.drawImage(mask, 0, 0);
}

function getMaskColor(e) {
    const rect = scene.getBoundingClientRect();
    const x = Math.floor((e.clientX - rect.left) * (mask.naturalWidth / rect.width));
    const y = Math.floor((e.clientY - rect.top) * (mask.naturalHeight / rect.height));
    const p = ctx.getImageData(x, y, 1, 1).data;
    return `${p[0]},${p[1]},${p[2]}`;
}

/* ---------------------------------------------------------
   Page manager
--------------------------------------------------------- */
function setPage(i) {
    currentPage = Math.max(0, Math.min(i, pages.length - 1));
    pages.forEach((p, idx) => p.style.display = idx === currentPage ? "block" : "none");
    pageCounter.textContent = `Page ${currentPage + 1}`;
    refresh();
}

/* ---------------------------------------------------------
   Book open/close
--------------------------------------------------------- */
function openBook() {
    bookOpen = true;
    book.style.opacity = 1;
    setPage(0);
}

function closeBook() {
    bookOpen = false;
    book.style.opacity = 0;
    refresh();
}

/* ---------------------------------------------------------
   Layout
--------------------------------------------------------- */
let content = {};

function computeContentArea() {
    const rect = bookImage.getBoundingClientRect();
    const insetX = rect.width * 0.06;
    const insetY = rect.height * 0.08;

    content = {
        left: rect.left + insetX,
        top: rect.top + insetY,
        width: rect.width - insetX * 2,
        height: rect.height - insetY * 2
    };
}

function layoutItems() {
    if (!bookOpen) return;

    const items = pages[currentPage].querySelectorAll(".item");

    items.forEach(el => {
        const x = parseFloat(el.dataset.x) / 100;
        const y = parseFloat(el.dataset.y) / 100;
        const w = parseFloat(el.dataset.w) / 100;

        el.style.width = content.width * w + "px";
        el.style.left = content.left + content.width * x + "px";
        el.style.top = content.top + content.height * y + "px";
    });
}

function syncHighlights() {
    const rect = scene.getBoundingClientRect();
    [hiBook, hiBack].forEach(h => {
        h.style.left = rect.left + "px";
        h.style.top = rect.top + "px";
        h.style.width = rect.width + "px";
        h.style.height = rect.height + "px";
    });
}

function refresh() {
    syncHighlights();
    computeContentArea();
    layoutItems();
}

/* ---------------------------------------------------------
   Click handling
--------------------------------------------------------- */
scene.addEventListener("mousemove", e => {
    const c = getMaskColor(e);

    if (bookOpen) {
        hiBook.style.opacity = 0;
        hiBack.style.opacity = c === "255,255,0" ? 1 : 0;
    } else {
        hiBook.style.opacity = c === "0,0,255" ? 1 : 0;
        hiBack.style.opacity = c === "255,255,0" ? 1 : 0;
    }
});

scene.addEventListener("mouseleave", () => {
    hiBook.style.opacity = 0;
    hiBack.style.opacity = 0;
});

scene.addEventListener("click", e => {
    const c = getMaskColor(e);

    if (c === "255,255,0") {
        if (bookOpen) closeBook();
        else window.location.href = "index.html";
        return;
    }

    if (!bookOpen && c === "0,0,255") {
        openBook();
        return;
    }

    if (bookOpen) {
        const rect = scene.getBoundingClientRect();
        const mid = rect.left + rect.width / 2;
        if (e.clientX < mid) setPage(currentPage - 1);
        else setPage(currentPage + 1);
    }
});


window.addEventListener("load", () => {
    drawMask();
    refresh();
});

window.addEventListener("resize", refresh);
</script>

</body>
</html>