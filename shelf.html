<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Shelf</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    background: black;
    height: 100%;
    overflow: hidden;
}

/* Scene layer */
#scene {
    position: absolute;
    left: 50%;
    top: 50%;
    height: 100%;
    width: auto;
    transform: translate(-50%, -50%);
    user-select: none;
}

#mask {
    display: none;
}

/* Highlights */
.highlight {
    position: absolute;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
}

/* Book overlay */
#book {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 40%;
    transform: translate(-50%, -50%);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease-in-out;
}

#bookImage {
    width: 100%;
    height: auto;
    display: block;
}

/* Pages */
.page {
    position: absolute;
    inset: 0;
    display: none;
}

/* Items */
.item {
    position: absolute;
    transform: translate(-50%, 0);
    object-fit: contain;
}

/* Page counter */
#pageCounter {
    position: absolute;
    right: 8%;
    bottom: 8%;
    color: white;
    font-family: sans-serif;
    font-size: 16px;
    pointer-events: none;
}
</style>
</head>
<body>

<!-- Background -->
<img id="scene" src="bookshelf.png">
<img id="mask" src="bookshelfclickmap.png">

<!-- Highlights -->
<img id="hiBook" class="highlight" src="Hibook1.png">
<img id="hiBack" class="highlight" src="HiBack.png">

<!-- Book -->
<div id="book">
    <img id="bookImage" src="book1.png">

    <div id="pages">

        <!-- Page 1 -->
        <div class="page">
            <img class="item" src="CorkboardArchive1.png" data-x="19" data-y="15" data-w="20">
            <img class="item" src="CorkboardArchive1.png" data-x="19" data-y="65" data-w="20">
            <img class="item" src="CorkboardArchive1.png" data-x="81" data-y="15" data-w="20">
            <img class="item" src="CorkboardArchive1.png" data-x="81" data-y="65" data-w="20">
        </div>

        <!-- Page 2 -->
        <div class="page">
            <img class="item" src="page2_img1.png" data-x="19" data-y="15" data-w="20">
            <img class="item" src="page2_img2.png" data-x="19" data-y="65" data-w="20">
            <img class="item" src="page2_img3.png" data-x="81" data-y="15" data-w="20">
            <img class="item" src="page2_img4.png" data-x="81" data-y="65" data-w="20">
        </div>

    </div>

    <div id="pageCounter">Page 1</div>
</div>

<script>
/* ---------------------------------------------------------
   DOM references
--------------------------------------------------------- */
const scene = document.getElementById("scene");
const mask = document.getElementById("mask");
const hiBook = document.getElementById("hiBook");
const hiBack = document.getElementById("hiBack");

const book = document.getElementById("book");
const bookImage = document.getElementById("bookImage");
const pages = Array.from(document.querySelectorAll(".page"));
const pageCounter = document.getElementById("pageCounter");

let currentPage = 0;
let bookOpen = false;

/* ---------------------------------------------------------
   Mask canvas
--------------------------------------------------------- */
const canvas = document.createElement("canvas");
const ctx = canvas.getContext("2d");

function drawMask() {
    if (!mask.naturalWidth) return;
    canvas.width = mask.naturalWidth;
    canvas.height = mask.naturalHeight;
    ctx.drawImage(mask, 0, 0);
}

function getMaskColor(e) {
    const rect = scene.getBoundingClientRect();
    const x = Math.floor((e.clientX - rect.left) * (mask.naturalWidth / rect.width));
    const y = Math.floor((e.clientY - rect.top) * (mask.naturalHeight / rect.height));
    const p = ctx.getImageData(x, y, 1, 1).data;
    return `${p[0]},${p[1]},${p[2]}`;
}

/* ---------------------------------------------------------
   Page manager
--------------------------------------------------------- */
function setPage(i) {
    currentPage = Math.max(0, Math.min(i, pages.length - 1));
    pages.forEach((p, idx) => p.style.display = idx === currentPage ? "block" : "none");
    pageCounter.textContent = `Page ${currentPage + 1}`;
    refresh();
}

/* ---------------------------------------------------------
   Book open/close
--------------------------------------------------------- */
function openBook() {
    bookOpen = true;
    book.style.opacity = 1;
    setPage(0);
}

function closeBook() {
    bookOpen = false;
    book.style.opacity = 0;
    refresh();
}

/* ---------------------------------------------------------
   Layout
--------------------------------------------------------- */
let content = {};

function computeContentArea() {
    const rect = bookImage.getBoundingClientRect();
    const insetX = rect.width * 0.06;
    const insetY = rect.height * 0.08;

    content = {
        left: rect.left + insetX,
        top: rect.top + insetY,
        width: rect.width - insetX * 2,
        height: rect.height - insetY * 2
    };
}

function layoutItems() {
    if (!bookOpen) return;

    const items = pages[currentPage].querySelectorAll(".item");

    items.forEach(el => {
        const x = parseFloat(el.dataset.x) / 100;
        const y = parseFloat(el.dataset.y) / 100;
        const w = parseFloat(el.dataset.w) / 100;

        el.style.width = content.width * w + "px";
        el.style.left = content.left + content.width * x + "px";
        el.style.top = content.top + content.height * y + "px";
    });
}

function syncHighlights() {
    const rect = scene.getBoundingClientRect();
    [hiBook, hiBack].forEach(h => {
        h.style.left = rect.left + "px";
        h.style.top = rect.top + "px";
        h.style.width = rect.width + "px";
        h.style.height = rect.height + "px";
    });
}

function refresh() {
    syncHighlights();
    computeContentArea();
    layoutItems();
}

/* ---------------------------------------------------------
   Click handling
--------------------------------------------------------- */
scene.addEventListener("mousemove", e => {
    const c = getMaskColor(e);

    if (bookOpen) {
        hiBook.style.opacity = 0;
        hiBack.style.opacity = c === "255,255,0" ? 1 : 0;
    } else {
        hiBook.style.opacity = c === "0,0,255" ? 1 : 0;
        hiBack.style.opacity = c === "255,255,0" ? 1 : 0;
    }
});

scene.addEventListener("mouseleave", () => {
    hiBook.style.opacity = 0;
    hiBack.style.opacity = 0;
});

scene.addEventListener("click", e => {
    const c = getMaskColor(e);

    if (c === "255,255,0") {
        if (bookOpen) closeBook();
        else window.location.href = "index.html";
        return;
    }

    if (!bookOpen && c === "0,0,255") {
        openBook();
        return;
    }

    if (bookOpen) {
        const rect = scene.getBoundingClientRect();
        const mid = rect.left + rect.width / 2;
        if (e.clientX < mid) setPage(currentPage - 1);
        else setPage(currentPage + 1);
    }
});

/* ---------------------------------------------------------
   Init
--------------------------------------------------------- */
window.addEventListener("load", () => {
    drawMask();
    refresh();
});

window.addEventListener("resize", refresh);
</script>
</body>
</html>